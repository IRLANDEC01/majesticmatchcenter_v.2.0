import searchQueue from '../src/queues/search-queue';

/**
 * –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å 'search-sync'.
 * –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è. –í—Å–µ –∑–∞–¥–∞—á–∏, –≤–∫–ª—é—á–∞—è
 * –∞–∫—Ç–∏–≤–Ω—ã–µ, –æ–∂–∏–¥–∞—é—â–∏–µ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ, –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.
 */
async function clearSearchQueue() {
  console.log("üßπ –û—á–∏—Å—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ 'search-sync'...");
  try {
    // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ Redis —á–µ—Ä–µ–∑ —ç–∫–∑–µ–º–ø–ª—è—Ä –æ—á–µ—Ä–µ–¥–∏
    await searchQueue.waitUntilReady();
    
    // –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–Ω–∏—á—Ç–æ–∂–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç—Ç–æ–π –æ—á–µ—Ä–µ–¥—å—é
    await searchQueue.obliterate();

    console.log("‚úÖ –û—á–µ—Ä–µ–¥—å 'search-sync' —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω–∞.");
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –æ—á–µ—Ä–µ–¥–∏:', error);
    process.exit(1);
  } finally {
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, —á—Ç–æ–±—ã —Å–∫—Ä–∏–ø—Ç –º–æ–≥ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è
    await searchQueue.close();
    console.log('üîå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å Redis –∑–∞–∫—Ä—ã—Ç–æ.');
    process.exit(0);
  }
}

clearSearchQueue(); 