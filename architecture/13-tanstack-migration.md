# –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ UI-—Å–ª–æ—è –Ω–∞ TanStack (Table + Virtual) 

> –í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ ‚Äî 2025-07-27

---

## 0. –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞

* **–¢–µ–∫—É—â–∏–π —Å—Ç–µ–∫**: Next 15.3 (App Router) + React 19 ‚Ä¢ TypeScript 5.8 ‚Ä¢ MongoDB + MeiliSearch ‚Ä¢ SWR ‚Üí **TanStack Query v5** ‚Ä¢ Tailwind + shadcn/ui.
* **–ì–æ—Ä—è—á–∏–µ –∑–æ–Ω—ã** ‚Äî –¥–ª–∏–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –∞–¥–º–∏–Ω–∫–µ (MapTemplates), –ø—É–±–ª–∏—á–Ω—ã–µ —Ä–µ–π—Ç–∏–Ω–≥–∏ –∏ –∏—Å—Ç–æ—Ä–∏—è –º–∞—Ç—á–µ–π.
* **–¶–µ–ª—å** ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å hand-made —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ headless-–¥–≤–∏–∂–æ–∫, –¥–æ–±–∞–≤–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é DOM –∏ –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—É—é –ø–∞–≥–∏–Ω–∞—Ü–∏—é –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-—Å–ª–æ—è.

---

## 1. –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –∏—Ö —Ä–æ–ª—å

| –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ | –í–µ—Ä—Å–∏—è | –§—É–Ω–∫—Ü–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ | –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ –æ–Ω–∞ |
|------------|--------|-------------------|-------------------|
| `@tanstack/react-table` | v8 (stable) | Headless –¥–≤–∏–∂–æ–∫ —Ç–∞–±–ª–∏—Ü: —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ / —Ñ–∏–ª—å—Ç—Ä—ã / –ø–∞–≥–∏–Ω–∞—Ü–∏—è / row-selection | Tree-shaking ‚âà 13 kB, 100 % –∫–æ–Ω—Ç—Ä–æ–ª—å —Ä–∞–∑–º–µ—Ç–∫–∏ (—à–∞–±–ª–æ–Ω + shadcn —Å—Ç–∏–ª—å) |
| `@tanstack/react-virtual` | v3 (stable) | –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–æ–∫/—Å—Ç–æ–ª–±—Ü–æ–≤ ‚Üí 60 FPS –¥–∞–∂–µ –ø—Ä–∏ 10 000 + —Å—Ç—Ä–æ–∫ | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç variable row height –∏ –ª–µ–≥–∫–æ —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å Table |
| `@tanstack/pacer` | alpha-0.1 | Throttle / debounce / keepLatest –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ | –£–Ω–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–µ—Ç–µ–≤–æ–≥–æ —à—É–º–∞, –º–µ–Ω—å—à–µ ¬´useEffect + useDebounce¬ª –∫–æ–¥–∞ |
| `@tanstack/react-form` | beta | (PoC) Headless —Ñ–æ—Ä–º—ã —Å Zod-adapter | –ú–æ–∂–µ—Ç –∑–∞–º–µ–Ω–∏—Ç—å RHF; –ø–æ–∫–∞ ‚Äî —Ç–æ–ª—å–∫–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –Ω–∞ –æ–¥–Ω–æ–º –¥–∏–∞–ª–æ–≥–µ |
| `@tanstack/store` | alpha | **–ù–ï** –≤–Ω–µ–¥—Ä—è–µ–º, –∂–¥—ë–º —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ | –°–µ–π—á–∞—Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ React Context/zustand –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ |

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

1. **FSD –æ—Å—Ç–∞—ë—Ç—Å—è**: `entities ‚Üí features ‚Üí shared`. –í—Å–µ –Ω–æ–≤—ã–µ –æ–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã –∫–ª–∞–¥—ë–º –≤ `shared/`.
2. **Headless + shadcn**: –ª–æ–≥–∏–∫–∞ (TanStack) –∏ –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ (shadcn) —Ä–∞–∑–¥–µ–ª–µ–Ω—ã, —á—Ç–æ–±—ã –¥–∏–∑–∞–π–Ω–µ—Ä—ã —Å–≤–æ–±–æ–¥–Ω–æ –º–µ–Ω—è–ª–∏ UI.
3. **–û–¥–∏–Ω —Ñ–∞—Å–∞–¥ –∏–º–ø–æ—Ä—Ç–∞**: `src/shared/tanstack/index.ts` ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ä–µ—ç–∫—Å–ø–æ—Ä—Ç —Ö—É–∫–æ–≤/–∫–æ–Ω—Å—Ç–∞–Ω—Ç; –ø—Ä–∏ –º–∞–∂–æ—Ä–Ω–æ–º –∞–ø–¥–µ–π—Ç–µ –º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ñ–∞—Å–∞–¥.
4. **Data-source –Ω–µ–∏–∑–º–µ–Ω–µ–Ω**: TanStack Query v5 –æ—Å—Ç–∞—ë—Ç—Å—è –µ–¥–∏–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –¥–∞–Ω–Ω—ã—Ö; Table/Virtual –Ω–µ —Ö–æ–¥—è—Ç –≤ —Å–µ—Ç—å –Ω–∞–ø—Ä—è–º—É—é.
5. **–ö—ç—à-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è & MeiliSearch**: —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –ª–æ–≥–∏–∫–∞ (Redis revision keys, search-queue) **–Ω–µ —Ç—Ä–æ–≥–∞—é—Ç—Å—è**; UI-—Å–ª–æ–π –ª–∏—à—å –º–µ–Ω—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ.

---

## 3. –ü–æ—à–∞–≥–æ–≤—ã–π —Ä–æ–∞–¥–º–∞–ø –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –≠—Ç–∞–ø 0 ‚Äî –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (¬Ω –¥–Ω—è)

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç—ã:
   ```bash
   npm i @tanstack/react-table @tanstack/react-virtual @tanstack/pacer
   ```
2. –°–æ–∑–¥–∞—Ç—å `src/shared/tanstack/index.ts`:
   ```ts
   export { useReactTable, type ColumnDef } from '@tanstack/react-table';
   export { useVirtualizer } from '@tanstack/react-virtual';
   export { pacer } from '@tanstack/pacer';
   export const DEFAULT_ROW_HEIGHT_PX = 48;
   ```
3. –î–æ–±–∞–≤–∏—Ç—å Jest-–º–æ–∫, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ: `__mocks__/tanstack.ts`.

### –≠—Ç–∞–ø 1 ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Table v8 (1 –¥–µ–Ω—å)

*–§–∞–π–ª—ã*: `entities/map-templates/ui/`

1. –°–æ–∑–¥–∞—Ç—å `mapTemplatesColumns.ts`:
   ```ts
   import { type ColumnDef } from '@/shared/tanstack';
   export const columns: ColumnDef<MapTemplate>[] = [
     { accessorKey: 'name', header: '–ù–∞–∑–≤–∞–Ω–∏–µ' },
     { accessorKey: 'createdAt', header: '–°–æ–∑–¥–∞–Ω', sortingFn: 'datetime' },
     // ‚Ä¶ –¥—Ä—É–≥–∏–µ –ø–æ–ª—è / —è—á–µ–π–∫–∞-—Ä–µ–Ω–¥–µ—Ä—ã
   ];
   ```
2. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `MapTemplatesTable.tsx`:
   ```tsx
   const table = useReactTable({
     data: templates,
     columns,
     getCoreRowModel: getCoreRowModel(),
     getSortedRowModel: getSortedRowModel(),
     state: { sorting },
     onSortingChange: setSorting,
   });
   ```
3. –†–µ–Ω–¥–µ—Ä —è—á–µ–µ–∫ ‚Äî —á–µ—Ä–µ–∑ `row.getVisibleCells()`.
4. –û—Å—Ç–∞–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `useMapTemplatesQuery`.

### –≠—Ç–∞–ø 2 ‚Äî –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ö—É–∫ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ ‚úÖ –ì–û–¢–û–í

**–°—Ç–∞—Ç—É—Å:** **–í–ù–ï–î–†–ï–ù–û** - —Å–æ–∑–¥–∞–Ω —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ö—É–∫ –¥–ª—è –õ–Æ–ë–´–• —Ç–∞–±–ª–∏—Ü.

**–ß—Ç–æ –≥–æ—Ç–æ–≤–æ:**
- ‚úÖ `useMaybeVirtualizer` - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (Player, Tournament, Family, MapTemplate)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –ø–æ threshold
- ‚úÖ –ì–æ—Ç–æ–≤—ã–µ –ø—Ä–µ—Å–µ—Ç—ã (admin, publicRatings, withImages, mobile, always, never)
- ‚úÖ –ü–æ–ª–Ω–∞—è TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –∏–∑ `@/shared/hooks`

**–ü—Ä–∏–º–µ—Ä—ã –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```tsx
// –ò–≥—Ä–æ–∫–∏
const { enableVirtual, virtualizer } = useMaybeVirtualizer(players);

// –¢—É—Ä–Ω–∏—Ä—ã —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º –ø–æ—Ä–æ–≥–æ–º
const { enableVirtual, virtualizer } = useMaybeVirtualizer(tournaments, { threshold: 50 });

// –ü—É–±–ª–∏—á–Ω—ã–µ —Ä–µ–π—Ç–∏–Ω–≥–∏
const { enableVirtual, virtualizer } = usePublicRatingsVirtualizer(ratings);

// –¢–∞–±–ª–∏—Ü—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
const { enableVirtual, virtualizer } = useImageTableVirtualizer(templates);
```

**–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å:** üéØ **–ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø** - –æ–¥–∏–Ω —Ö—É–∫ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –ø—Ä–æ–µ–∫—Ç–∞

### –≠—Ç–∞–ø 3 ‚Äî –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è (¬Ω –¥–Ω—è)

1. –î–æ–±–∞–≤–∏—Ç—å `getPaginationRowModel()` –≤ Table.
2. –ö–Ω–æ–ø–∫–∏ prev/next + —Å–µ–ª–µ–∫—Ç 10/25/50 —Ä–µ–∞–ª–∏–∑—É–µ–º –Ω–∞ shadcn `Button`, `Select`.
3. –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ React state (`pageIndex`, `pageSize`).

### –≠—Ç–∞–ø 4 ‚Äî —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è (1 –¥–µ–Ω—å)

1. –í `useMapTemplatesQuery` –¥–æ–±–∞–≤–ª—è–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã `page`, `limit` –≤ `queryKey` –∏ `fetch`.
2. –í Table –≤–∫–ª—é—á–∞–µ–º `manualPagination: true` –∏ –ø–µ—Ä–µ–¥–∞—ë–º `pageCount` –∏–∑ API.
3. –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –ø—Ä–µ–∂–Ω–µ–π: `queryClient.invalidateQueries(['mapTemplates', ‚Ä¶])`.

### –≠—Ç–∞–ø 5 ‚Äî —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è debounce (Pacer) (¬Ω –¥–Ω—è)

```ts
const pacedFetch = useMemo(() =>
  pacer.keepLatest((signal) => fetch(url, { signal }).then(r => r.json()), {
    interval: 300,
  }),
[]);
```

* –ó–∞–º–µ–Ω—è–µ–º `use-debounce`. –¢–µ–ø–µ—Ä—å throttle/queue —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ.

### –≠—Ç–∞–ø 6 ‚Äî TanStack Form –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ñ–æ—Ä–º (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:**
- 10+ –ø–æ–ª–µ–π –≤ —Ñ–æ—Ä–º–µ
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –º–∞—Å—Å–∏–≤—ã (`prizeTiers[].amount`)
- –£—Å–ª–æ–≤–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å –ø–æ–ª–µ–π
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
- –ú—É–ª—å—Ç–∏-—Å—Ç—ç–ø —Ñ–æ—Ä–º—ã

**–ü—Ä–æ—Å—Ç—ã–µ —Ñ–æ—Ä–º—ã –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ RHF** (< 5 –ø–æ–ª–µ–π, –±–µ–∑ –¥–∏–Ω–∞–º–∏–∫–∏)

**–ü–ª–∞–Ω:**
1. –í—ã–±—Ä–∞—Ç—å —Å–∞–º—É—é —Å–ª–æ–∂–Ω—É—é —Ñ–æ—Ä–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–°–æ–∑–¥–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä")
2. PoC –Ω–∞ TanStack Form –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –≤–µ—Ç–∫–µ
3. –°—Ä–∞–≤–Ω–∏—Ç—å DX, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
4. –ü—Ä–∏ –≤—ã–∏–≥—Ä—ã—à–µ ‚â• 20% - –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Ñ–æ—Ä–º—ã

### –≠—Ç–∞–ø 7 ‚Äî TanStack Store (–ø–æ–∫–∞ –æ—Ç–ª–æ–∂–µ–Ω–æ)

* –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≤ alpha ‚Üí –∂–¥—ë–º —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏. –î–æ —Ç–µ—Ö –ø–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π React state / Context.

### –≠—Ç–∞–ø 8 ‚Äî —Ç–∏—Ä–∞–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ (2-3 –¥–Ω—è)

1. ~~–ö–æ–ø–∏—Ä—É–µ–º –∫–æ–ª–æ–Ω–∫-–∫–æ–Ω—Ñ–∏–≥, –º–µ–Ω—è–µ–º —Ç–∏–ø `Player`, `Tournament` –∏ —Ö—É–∫ `usePlayersQuery`.~~
2. ~~–ü–æ–ª—É—á–∞–µ–º —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤–æ –≤—Å–µ–π –∞–¥–º–∏–Ω–∫–µ.~~

---

## 4. –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|-------------|------------|
| `BaseTable` | `shared/ui/base-table.tsx` | –û–±—ë—Ä—Ç–∫–∞, –ø—Ä–∏–Ω–∏–º–∞—é—â–∞—è `columns`, `data`, `rowVirtualizer` –∏ —Ä–∏—Å—É—é—â–∞—è `<table>` + —à–∞–ø–∫–∏ |
| `PaginationControls` | `shared/ui/pagination-controls.tsx` | –ö–Ω–æ–ø–∫–∏ prev/next, —Å–µ–ª–µ–∫—Ç pageSize, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä ¬´—Å—Ç—Ä. X –∏–∑ Y¬ª |
| `MapTemplatesTable` | `entities/map-templates/ui/` | –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: –ø–µ—Ä–µ–¥–∞—ë—Ç —Å–≤–æ–∏ –∫–æ–ª–æ–Ω–∫–∏ + –¥–∞–Ω–Ω—ã–µ –≤ `BaseTable`, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç edit/archive/restore |
| `useMapTemplatesQuery` | `entities/map-templates/lib/` | –•—É–∫ (Pacer + TanStack Query) –¥–ª—è –ø–æ–∏—Å–∫–∞/–ª–∏—Å—Ç–∏–Ω–≥–∞ —à–∞–±–ª–æ–Ω–æ–≤ –∫–∞—Ä—Ç |

*–ü–ª—é—Å*: –∫–æ–¥ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π **–Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç—Å—è** –≤ —Ä–∞–º–∫–∞—Ö –¥–∞–Ω–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏.

---

## 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TanStack Query, Redis-–∫—ç—à–µ–º –∏ MeiliSearch

1. **Query Keys**: –¥–æ–±–∞–≤–ª—è–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã `page`, `limit`, `sorting` –≤ –º–∞—Å—Å–∏–≤ –∫–ª—é—á–∞ ‚Üí Query –∑–Ω–∞–µ—Ç, –∫–æ–≥–¥–∞ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è.
2. **TTL**: client-cache –∂–∏–≤—ë—Ç 30 —Å–µ–∫ (—Ç–∞–∫ –∂–µ, –∫–∞–∫ Redis TTL `listShort`).
3. **Server-cache**: —Å–µ—Ä–≤–∏—Å `map-template-service.getMapTemplates()` —É–∂–µ —á–∏—Ç–∞–µ—Ç/–∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç Redis. –ù–∏—á–µ–≥–æ –º–µ–Ω—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.
4. **MeiliSearch**: UI-—Å–ª–æ–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `q` –≤ —Ç–æ—Ç –∂–µ endpoint `/api/admin/search`. Pacer –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø—Ä–∏ —Å–∫–æ—Ä–æ—Å—Ç–Ω–æ–º –≤–≤–æ–¥–µ –±—É–¥–µ—Ç **–æ–¥–∏–Ω** ¬´–∞–∫—Ç—É–∞–ª—å–Ω—ã–π¬ª –∑–∞–ø—Ä–æ—Å.
5. **Invalidation**: –ø–æ—Å–ª–µ –º—É—Ç–∞—Ü–∏–π (`archive`, `update`) –º—ã —É–∂–µ –¥–µ—Ä–≥–∞–µ–º `queryClient.invalidateQueries`. Table –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∂–µ—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ.

---

## 6. –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**–ü–æ—á–µ–º—É –Ω–µ `AG Grid`?** ‚Äî 700 kB + GPL/enterprise, —Å–ª–æ–∂–Ω–æ –ø–æ–¥—Ä—É–∂–∏—Ç—å —Å shadcn.

**–ú–æ–∂–Ω–æ –ª–∏ –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç Redis-revision –ø–æ—Å–ª–µ Table?** ‚Äî –ù–µ—Ç: —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è –≤—Å—ë –µ—â—ë –∏—Å–ø–æ–ª—å–∑—É–µ—Ç revision-–∫–ª—é—á –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏.

**–ö–æ–≥–¥–∞ –≤–Ω–µ–¥—Ä—è—Ç—å TanStack Store?** ‚Äî –ö–æ–≥–¥–∞ –≤—ã–π–¥–µ—Ç beta-–∏–ª–∏-stable. –ü–æ–∫–∞ risks > benefits.

---

## 7. –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ Pull Request

1. `npm run lint && npm run test` ‚Äî –∑–µ–ª—ë–Ω—ã–µ.  
2. –í PR —É–∫–∞–∑–∞—Ç—å ¬´–≠—Ç–∞–ø N TanStack Migration¬ª.  
3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (—ç—Ç–æ—Ç —Ñ–∞–π–ª + `memory-bank/progress.md`).  
4. Remote-cache/Redis/MeiliSearch –º–µ—Ç—Ä–∏–∫–∏ –Ω–µ —É—Ö—É–¥—à–∏–ª–∏—Å—å.

---

## 8. –§–ò–ù–ê–õ–¨–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø (–æ–±–Ω–æ–≤–ª–µ–Ω–æ –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞)

### üéØ **–ü—Ä–∏–Ω—Ü–∏–ø: "–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –¥–æ–∫–∞–∑–∞–Ω–Ω–æ–π –ø–æ–ª—å–∑–µ"**

–ü–æ—Å–ª–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤—ã—è–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:

#### **TanStack Virtual - —É—Å–ª–æ–≤–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ**
**‚ùå –ü—Ä–æ–±–ª–µ–º—ã "–ø—Ä–æ—Å—Ç–æ —Ç–∞–∫":**
- –°–ª–æ–∂–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ (overflow, absolute positioning, height calculations)
- Race conditions –ø—Ä–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- Zero benefit –ø—Ä–∏ 15-100 —Å—Ç—Ä–æ–∫–∞—Ö
- –¢—Ä—É–¥–Ω–µ–µ debugging –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**‚úÖ –†–µ—à–µ–Ω–∏–µ - —É—Å–ª–æ–≤–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ:**
```tsx
const enableVirtual = rows.length > 100 || isInfiniteScroll;
```

#### **TanStack Form - —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ñ–æ—Ä–º**
**‚ùå –ü—Ä–æ–±–ª–µ–º—ã –º–∞—Å—Å–æ–≤–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:**
- –î–≤–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Ñ–æ—Ä–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- Beta-—Å—Ç–∞—Ç—É—Å —Å breaking changes
- –ë–∞–Ω–¥–ª +7KB –±–µ–∑ –ø–æ–ª—å–∑—ã –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ñ–æ—Ä–º

**‚úÖ –†–µ—à–µ–Ω–∏–µ - –∫—Ä–∏—Ç–µ—Ä–∏–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:**
- 10+ –ø–æ–ª–µ–π
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –º–∞—Å—Å–∏–≤—ã (`prizeTiers[]`)
- –£—Å–ª–æ–≤–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å –ø–æ–ª–µ–π
- –ú—É–ª—å—Ç–∏-—Å—Ç—ç–ø workflow

---

## 9. –û–ë–ù–û–í–õ–ï–ù–ù–´–ô –†–û–ê–î–ú–ê–ü

### **‚úÖ –≠—Ç–∞–ø A: Infinite Scroll + Conditional Virtualization - –ó–ê–í–ï–†–®–ï–ù (29.01.2025)**

#### –ó–∞–¥–∞—á–∞: –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π infinite scroll —Å —É–º–Ω–æ–π –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–µ–π

**–ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
1. ‚úÖ `src/entities/map-templates/lib/use-infinite-map-templates-query.ts` - infinite scroll —Ö—É–∫
2. ‚úÖ `src/entities/map-templates/ui/map-templates-table.tsx` - enhanced —Å infinite –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π  
3. ‚úÖ `src/features/map-templates-management/ui/map-templates-page-content.tsx` - production UI

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
```tsx
// ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û: useInfiniteQuery —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≥—Ä—É–∑–∫–æ–π
const { templates, hasNextPage, loadMore } = useInfiniteMapTemplatesQuery({
  searchTerm,
  status,
});

// ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û: Intersection Observer –¥–ª—è –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏
useEffect(() => {
  const observer = new IntersectionObserver((entries) => {
    if (entries[0].isIntersecting && hasNextPage) {
      loadMore();
    }
  });
  if (sentinelRef.current) observer.observe(sentinelRef.current);
}, [hasNextPage, loadMore]);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:**
```tsx
// ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û: –£–º–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
<MapTemplatesTable
  templates={allTemplatesFromAllPages}
  hasNextPage={hasNextPage}
  isFetchingNextPage={isFetchingNextPage}
  loadMore={loadMore}
  // –ü—Ä–∏ >100 –∑–∞–ø–∏—Å–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è
  // –ü—Ä–∏ <100 –∑–∞–ø–∏—Å–µ–π –æ–±—ã—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –±–µ–∑ overhead
/>
```

### **‚úÖ –≠—Ç–∞–ø B: TanStack Pacer Migration - –ó–ê–í–ï–†–®–ï–ù (–Ø–Ω–≤–∞—Ä—å 2025)**

#### –ß—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:
- ‚úÖ **–ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ use-debounce** –Ω–∞ TanStack Pacer
- ‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞—Å–∞–¥** –≤ `src/shared/tanstack/index.ts` 
- ‚úÖ **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã:** `PACER_INTERVALS.SEARCH`, `AUTOSAVE`, etc.
- ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω—ã–µ —Ö—É–∫–∏:** `usePacerDebounce`, `usePacerDebouncedCallback`
- ‚úÖ **API —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º `isPending` —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- ‚úÖ **–ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Ö—É–∫–∏:** `useSearch`, `useMapTemplatesQuery`
- ‚úÖ **–£–¥–∞–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å** use-debounce –∏–∑ package.json
- ‚úÖ **–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º–∞—è –≤—ã—Å–æ—Ç–∞ —Å—Ç—Ä–æ–∫** —á–µ—Ä–µ–∑ `NEXT_PUBLIC_TABLE_ROW_HEIGHT`

#### –£–ª—É—á—à–µ–Ω–∏—è UX:
- üéØ **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã** –≤–æ –≤—Å–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- üìä **isPending —Å–æ—Å—Ç–æ—è–Ω–∏–µ** –¥–ª—è better loading indicators  
- üîß **Cancel —Ñ—É–Ω–∫—Ü–∏–∏** –¥–ª—è manual –æ—Ç–º–µ–Ω—ã debounce
- ‚öôÔ∏è **Environment configuration** –¥–ª—è –≤—ã—Å–æ—Ç—ã —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü

### **–≠—Ç–∞–ø C: PoC TanStack Form –Ω–∞ —Å–ª–æ–∂–Ω–æ–π —Ñ–æ—Ä–º–µ (2-3 –¥–Ω—è)**

#### –¶–µ–ª—å: –î–æ–∫–∞–∑–∞—Ç—å –≤—ã–≥–æ–¥—É –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ

**–ö–∞–Ω–¥–∏–¥–∞—Ç—ã –¥–ª—è PoC (–ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏):**
1. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞** - ~20 –ø–æ–ª–µ–π, –º–∞—Å—Å–∏–≤—ã `prizeTiers`, —É—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
2. **–°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–∞** - ~15 –ø–æ–ª–µ–π, –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤, –≤–∞–ª–∏–¥–∞—Ü–∏—è
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–º—å–∏** - –º–∞—Å—Å–∏–≤—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ PoC:**
- –ö–æ–¥ –∫–æ—Ä–æ—á–µ –Ω–∞ ‚â•20%
- –ú–µ–Ω—å—à–µ `useEffect` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –õ—É—á—à–µ DX –¥–ª—è –º–∞—Å—Å–∏–≤–æ–≤ –∏ —É—Å–ª–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏
- –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ beta-—Å—Ç–∞—Ç—É—Å–µ

**–ï—Å–ª–∏ PoC –ø—Ä–æ–≤–∞–ª–∏–ª—Å—è** ‚Üí –æ—Å—Ç–∞—ë–º—Å—è –Ω–∞ RHF –¥–ª—è –≤—Å–µ—Ö —Ñ–æ—Ä–º
**–ï—Å–ª–∏ PoC —É—Å–ø–µ—à–µ–Ω** ‚Üí –º–∏–≥—Ä–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Å–ª–æ–∂–Ω—ã–µ —Ñ–æ—Ä–º—ã

### **–≠—Ç–∞–ø C: –û—á–∏—Å—Ç–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (1 –¥–µ–Ω—å)**

#### –£–±–∏—Ä–∞–µ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ –æ—Ç —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤

1. **–£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–∞–π–ª—ã:**
   - ‚úÖ `map-templates-table-virtualized.tsx` (—É–¥–∞–ª–µ–Ω - –±–µ—Å—Å–º—ã—Å–ª–µ–Ω –ø—Ä–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ 15 –∑–∞–ø–∏—Å–µ–π)
   - –î—É–±–ª–∏—Ä—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

2. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å API:**
   - –û–¥–∏–Ω `MapTemplatesTable` —Å –ø—Ä–æ–ø–æ–º `enableVirtual`
   - –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏

3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è trigger-points:**
   - –ö–æ–≥–¥–∞ –≤–∫–ª—é—á–∞—Ç—å Virtual (>100 —Å—Ç—Ä–æ–∫, infinite scroll)
   - –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TanStack Form (—Å–ª–æ–∂–Ω–æ—Å—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏)

---

## 10. –ö–û–ù–ö–†–ï–¢–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –¢–ï–ö–£–©–ï–ì–û –ö–û–î–ê

### **‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –£–¥–∞–ª–µ–Ω–∞ –Ω–µ–Ω—É–∂–Ω–∞—è –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è**

**–ü—Ä–æ–±–ª–µ–º–∞:** `map-templates-table-virtualized.tsx` —Å–æ–¥–µ—Ä–∂–∞–ª –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π 15 –∑–∞–ø–∏—Å–µ–π.

**–†–µ—à–µ–Ω–∏–µ:** –§–∞–π–ª —É–¥–∞–ª–µ–Ω –∫–∞–∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π. –ü—Ä–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ 15 –∑–∞–ø–∏—Å–µ–π –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–∞.

**–í—ã–≤–æ–¥:** –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–ª—É—á–∞–µ–≤ –±–µ–∑ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –¥–∞–Ω–Ω—ã—Ö (–ø—É–±–ª–∏—á–Ω—ã–µ —Ä–µ–π—Ç–∏–Ω–≥–∏, infinite scroll).

### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**
```tsx
// –í–º–µ—Å—Ç–æ –¥–≤—É—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
<MapTemplatesTable />           // –æ–±—ã—á–Ω–∞—è
<MapTemplatesTableVirtualized /> // –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è

// –û–¥–∏–Ω —É–º–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
<MapTemplatesTable 
  enableVirtual={rows.length > 100} 
  containerHeight="600px"
/>
```

---

> –î–æ–∫—É–º–µ–Ω—Ç –≥–æ—Ç–æ–≤. –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ —Å–æ–≥–ª–∞—Å–Ω–∞ ‚Äî –¥–≤–∏–≥–∞–µ–º—Å—è –∫ **–≠—Ç–∞–ø—É 0**. 