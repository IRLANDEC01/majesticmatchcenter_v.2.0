# Бизнес-логика: Семьи и Игроки

Этот документ описывает бизнес-правила и жизненный цикл ключевых сущностей: Семьи (`Family`) и Игроки (`Player`).

## 1. Семья (Family)

### 1.1. Жизненный цикл

#### Создание
*   **Правило 1.1.1:** Семья не может существовать без владельца (`owner`). При создании семьи обязательно должен быть указан активный игрок, который станет ее владельцем.
*   **Правило 1.1.2:** Игрок, назначенный владельцем, автоматически становится первым участником семьи. Эта операция должна быть атомарной.

#### Управление составом
*   **Правило 1.2.1 (Валидация при добавлении):** При добавлении игрока в семью система должна проверить и убедиться, что:
    *   Игрок не находится в архиве.
    *   Игрок на данный момент не состоит в другой семье (его поле `familyId` должно быть `null`).
*   **Правило 1.2.2 (UI/UX):** Логика управления составом (добавление/удаление игроков) должна быть доступна в двух местах для удобства администратора:
    *   На странице редактирования игрока (возможность добавить его в семью или удалить из текущей).
    *   На странице редактирования семьи (возможность управлять полным списком участников).

#### Управление владельцем
*   **Правило 1.3.1:** Владельца нельзя просто удалить из состава семьи, так как это оставит семью без обязательного владельца.
*   **Правило 1.3.2:** Единственный способ сменить владельца — это выполнить операцию **"Сменить владельца"**, выбрав другого **активного** участника этой же семьи. После успешной смены предыдущий владелец становится обычным участником, и его можно будет удалить из семьи стандартным способом.

#### Архивация
*   **Правило 1.4.1 (Условие архивации):** Семью можно перевести в архив только в том случае, если она на данный момент **не участвует ни в одном активном (незавершенном) турнире**.
*   **Правило 1.4.2:** Архивация семьи **не влияет** на ее текущий состав. Все игроки остаются приписанными к ней.
*   **Правило 1.4.3:** Заархивированную семью нельзя добавить в новый турнир.

### 1.2. Связанные сущности и отображение

*   **Правило 1.5.1 (Отображение архивных участников):** В списке состава семьи (например, в админ-панели) должны отображаться **все** участники, включая архивных. Архивные игроки должны быть визуально помечены (например, серым цветом и/или иконкой), чтобы администратор имел полную и правдивую картину состава.

## 2. Игрок (Player)

### 2.1. Жизненный цикл

#### Архивация
*   **Правило 2.1.1 (Условие архивации):** Игрока **категорически запрещено** архивировать, если он в данный момент является владельцем какой-либо семьи.
*   **Правило 2.1.2:** Если игрок является обычным участником семьи, его можно архивировать. Это не удаляет его из семьи.

### 2.2. Связанные сущности

*   **Правило 2.2.1:** Заархивированного игрока нельзя добавить ни в одну семью.
*   **Правило 2.2.2 (Влияние на события):** Основная цель архивации игрока — исключить его из выбора при формировании составов на новые карты и события, даже если его семья участвует в них.

## 3. Общие правила для UI/UX в Админ-панели

*   **Правило 3.1 (Фильтрация списков):** На страницах, отображающих списки сущностей (Семьи, Игроки, Шаблоны и т.д.), не должно быть фильтра "Все". Вместо этого должны быть два четких режима просмотра: **"Активные"** (по умолчанию) и **"Архивные"**. 