Ниже ‒ «разложено по полочкам» каждое из трёх вопросов.

1. Какой инструмент для форм? Что сейчас?
   • СЕЙЧАС: MapTemplateDialog управляет полями обычным useState.
     Нет ни react-hook-form, ни другого менеджера.
     Валидация выполняется ТОЛЬКО на сервере через Zod-схемы.
   ЧТО СДЕЛАТЬ:
     — для малых модальных форм (шаблон карты, шаблон турнира) — перейти на react-hook-form + zodResolver.
       Причины: зрелая библиотека, примеры в shadcn/ui, мгновенная клиентская валидация, минимальный код.
     — для больших страниц-мастеров (создание турнира/карты) можно протестировать TanStack Form — он headless, реактивный и хорошо подойдёт, когда полей десятки.
     Так оба сценария закрыты оптимальными инструментами, а мигрировать между ними будет легко, потому что UI-страта (shadcn FormField) неизменна.
2. Где делать «минимальную» валидацию?
   • Клиент (RHF + zodResolver):
     — обязательность полей (required, minLength, maxLength);
     — проверка, что загружен файл/URL;
     — проверка размера файла ≤ 10 MB и типа (image/png|jpeg|webp).
     Ошибки появляются мгновенно, пользователь не ждёт round-trip.
   Сервер (Server Action + та же Zod-схема):
     — повторяем ВСЁ вышеперечисленное (безопасность);
     — уникальность имени/slug;
     — права доступа (canArchive, canCreate);
     — проверка загруженного файла после sharp (не SVG, не скрипт).
   Таким образом единый Zod-объект используется и там и там, но клиенту можно отключить «тяжёлые» бизнес-валидаторы (например, уникальность) — отсекаем только очевидные ошибки.
3. S3 сейчас или позже?
   Варианты:
   A) Сразу S3 + финальная форма
   Делаете один раз и больше не переделываете.
   Сразу проверите пайплайн “браузер → сервер → S3 → URL”.
   Чуть больше времени на DevOps (создать бакет, настроить ACL/CORS, внедрить SDK).
   B) Пока заглушка, потом переделывать
   Можно сделать форму быстрее.
   Придётся менять код мутаций, Server Action, Zod-схему (тип поля File | string) и UI (FileDropzone vs. text URL).
   Двойная работа по тестированию.
   Рекомендация: Если у вас уже есть доступ к S3 Reg.Ru и ключам, настройте сразу «правильный» путь (A). Это один вечер работы, зато:
   не придётся переписывать схему и мутации;
   сразу увидите реальные ошибки загрузки;
   будет готов шаблон для всех будущих сущностей (игрок-аватары, баннеры турниров и т.д.).
   Минимальный чек-лист «сразу S3»
   Создать бакет, выписать S3_ENDPOINT, S3_BUCKET, ключи.
   Утилита saveToS3(buffer,key,ctype) как показано ранее.
   Компонент FileDropzone в shared/ui.
   Валидация файла (тип/размер) в RHF Zod-схеме.
   Server Action:
   принимает File,
   резайз sharp,
   загружает в S3,
   возвращает URL.
   В БД храните готовый URL.
   Вывод в одну строку
   • Переписываем модальные формы на react-hook-form + zodResolver (мгновенная клиентская валидация).
   Валидацию «обязательное/тип/размер» держим на клиенте и сервере; бизнес-правила только на сервере.
   Настраиваем S3 сразу, чтобы не переделывать; код загрузки станет универсальным для всех будущих сущностей.
