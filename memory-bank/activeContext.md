# Active Context

На данный момент проект находится на начальной стадии разработки ("с нуля"). Вся предоставленная документация описывает целевую архитектуру и стек, которые должны быть реализованы. Главный фокус сейчас — заложить прочный фундамент, строго следуя описанным архитектурным принципам (гексагональная архитектура, DDD, разделение слоев) и паттернам.

Особое внимание следует уделить созданию правильной структуры проекта, настройке окружения для разработки и CI/CD, а также реализации базовых абстракций, таких как адаптер для кэша.

Критически важным является замечание из документа `04-business-logic.md`: бизнес-логика будет постоянно дорабатываться. Это означает, что при реализации доменных моделей и сервисов необходимо сохранять гибкость и быть готовым к изменениям. Перед реализацией сложных бизнес-правил следует запрашивать подтверждение у владельца продукта.

**Обновление**: Настроена тестовая среда с использованием **Jest 30**. Это позволило решить проблемы с несовместимостью CommonJS (Jest) и ESM-only модулей (Mongoose 8+). Тесты запускаются в среде `node`, а зависимости (Redis, MongoDB) мокируются с помощью `ioredis-mock` и `mongodb-memory-server`.

# Активный контекст

Этот файл содержит информацию, относящуюся к текущей задаче. Он будет очищен или заархивирован после завершения задачи.

## План разработки: Вертикальный срез "Управление Турнирами"

**Цель:** Создать полностью рабочую, сквозную (UI → API → DB) функциональность для создания и базового управления Турнирами в админ-панели.

### Жизненный цикл Турнира: Бизнес-логика

#### Статусы
- `planned`: Создан, но регистрация закрыта.
- `registration_open`: Открыта регистрация участников.
- `registration_closed`: Регистрация завершена, состав участников финальный.
- `active`: Турнир идет, карты генерируются и проводятся.
- `completed`: Турнир завершен, победители определены.
- `archived`: Турнир завершен и перенесен в архив.

#### 1. Создание Турнира (Creation)
- **Триггер:** Администратор нажимает "Создать турнир".
- **Логика:** Создается документ `Tournament` со статусом `planned`. Карты и участники пока пустые.

#### 2. Регистрация (Registration)
- **Триггер:** Админ меняет статус на `registration_open`.
- **Логика:** Админ наполняет массив `participants`. После завершения меняет статус на `registration_closed`.

#### 3. Начало Турнира (Active)
- **Триггер:** Админ нажимает "Начать турнир".
- **Логика:** Статус меняется на `active`. Автоматически генерируются все документы `Map` на основе шаблона.

#### 4. Проведение (In Progress)
- **Триггер:** Админ завершает карты через UI.
- **Логика:** Используется `map-service.completeMap`. Статус отдельных карт обновляется.

#### 5. Завершение (Completion)
- **Триггер:** Админ нажимает "Завершить турнир" (когда все карты `completed`).
- **Логика:** Статус меняется на `completed`. Победитель определяется по числу выигранных карт.
- **Будущие задачи:** Начисление призов, обновление глобальной статистики.

#### 6. Архивация (Archived)
- **Триггер:** Админ нажимает "Архивировать".
- **Логика:** Устанавливается поле `archivedAt`. 