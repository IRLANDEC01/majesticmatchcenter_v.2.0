# Active Context ‚Äî –Ø–Ω–≤–∞—Ä—å 2025

## üéØ **–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞**

### ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û: Map Templates Migration (–Ø–Ω–≤–∞—Ä—å 2025)**
**–°—Ç–∞—Ç—É—Å:** 100% –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –≥–æ—Ç–æ–≤–æ –∫–∞–∫ —ç—Ç–∞–ª–æ–Ω–Ω–∞—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å

**–ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ **TanStack Query v5** - –ø–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å SWR
- ‚úÖ **S3 File Storage** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –†–µ–≥.—Ä—É –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ **ImageSet Schema** - —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ **React Hook Form** + FileDropzone –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- ‚úÖ **Server Actions** —Å —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π –∏ S3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
- ‚úÖ **–î–≤–æ–π–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è** –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **Next.js Image** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è S3 –¥–æ–º–µ–Ω–∞
- ‚úÖ **Comprehensive Testing** - unit + integration —Ç–µ—Å—Ç—ã

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**
- **Reference Implementation** - Map Templates —Ç–µ–ø–µ—Ä—å —ç—Ç–∞–ª–æ–Ω –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
- **FSD Compliance** - 100% —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ Feature-Sliced Design
- **TypeScript Migration** - –ø–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –±–µ–∑ any
- **Performance Optimization** - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏

## üîÑ **–°–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã**

### 1. **Migration –¥—Ä—É–≥–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –Ω–∞ TanStack Query v5**
**–ü–æ—Ä—è–¥–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–∏ (–ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏):**
1. **Tournament Templates** - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ Map Templates, –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
2. **Players** - –¥–æ–±–∞–≤–∏—Ç—å –∞–≤–∞—Ç–∞—Ä—ã —á–µ—Ä–µ–∑ S3
3. **Families** - –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–æ—Ç–∏–ø—ã —á–µ—Ä–µ–∑ S3  
4. **Tournaments** - —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞, –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏

**–ß—Ç–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ Map Templates:**
- Query —Ö—É–∫–∏ (`useEntityQuery`)
- Mutation —Ö—É–∫–∏ (`useEntityMutations`) 
- Form –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (React Hook Form)
- Table UI patterns
- Server Actions structure

### 2. **S3 Integration –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π**
**–ö–∞–Ω–¥–∏–¥–∞—Ç—ã –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
- **Players** - –∞–≤–∞—Ç–∞—Ä—ã –∏–≥—Ä–æ–∫–æ–≤
- **Families** - –ª–æ–≥–æ—Ç–∏–ø—ã —Å–µ–º–µ–π
- **Tournaments** - –±–∞–Ω–Ω–µ—Ä—ã —Ç—É—Ä–Ω–∏—Ä–æ–≤

**–ß—Ç–æ –≥–æ—Ç–æ–≤–æ –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
- ImageSet schema
- Upload service
- FileDropzone component
- Image processing pipeline

### 3. **Documentation Updates**
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã system patterns (v2.5)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω tech context
- ‚úÖ –°–æ–∑–¥–∞–Ω S3 architecture document
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω architecture README

## üõ†Ô∏è **–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

### **–°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π:**
- **Frontend:** Next.js 15.3 + React 19 + TypeScript 5.8.3
- **Data Layer:** TanStack Query v5 (–≤–º–µ—Å—Ç–æ SWR)
- **File Storage:** S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–†–µ–≥.—Ä—É)
- **Forms:** React Hook Form + Zod + FileDropzone
- **UI:** shadcn/ui + Tailwind CSS
- **Architecture:** Feature-Sliced Design (FSD)

### **–ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–∞–Ω–Ω—ã—Ö:**
```typescript
// Query pattern
const { data, isLoading, error } = useEntityQuery(searchTerm);

// Mutation pattern  
const { mutateAsync } = useCreateEntityMutation();

// Double invalidation pattern
await mutateAsync(formData);
await refetch(); // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```

### **S3 Integration pattern:**
```typescript
// Upload with variants
const result = await uploadImageVariants(file, 'entity-type');
// Result: { keys: {...}, urls: {...}, metadata: {...} }

// Schema integration
const entitySchema = new Schema({
  imageUrls: { type: imageSetSchema, required: false },
  imageKeys: { type: imageKeysSchema, required: false },
});
```

## üìä **–ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞**

### **Map Templates (—ç—Ç–∞–ª–æ–Ω):**
- ‚úÖ **TypeScript Coverage:** 100%
- ‚úÖ **ESLint Errors:** 0
- ‚úÖ **FSD Compliance:** 100%
- ‚úÖ **Test Coverage:** Comprehensive (unit + integration)
- ‚úÖ **Performance:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏

### **–û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏:**
- ‚ö†Ô∏è **TypeScript Coverage:** ~80%
- ‚ö†Ô∏è **Data Layer:** –£—Å—Ç–∞—Ä–µ–≤—à–∏–π SWR
- ‚ö†Ô∏è **File Storage:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- ‚ö†Ô∏è **Testing:** –¢—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

## üéØ **–ë–ª–∏–∂–∞–π—à–∏–µ –∑–∞–¥–∞—á–∏ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)**

### **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
1. **Tournament Templates Migration** - –Ω–∞—á–∞—Ç—å —Å –ø—Ä–æ—Å—Ç–µ–π—à–µ–π —Å—É—â–Ω–æ—Å—Ç–∏
2. **Players Avatar Integration** - –¥–æ–±–∞–≤–∏—Ç—å S3 –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤
3. **Performance Monitoring** - –æ—Ç—Å–ª–µ–¥–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏—è –ø–æ—Å–ª–µ TanStack Query

### **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
4. **Families Logo Integration** - S3 –¥–ª—è –ª–æ–≥–æ—Ç–∏–ø–æ–≤ —Å–µ–º–µ–π
5. **Search Optimization** - —É–ª—É—á—à–∏—Ç—å Meilisearch –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
6. **Error Boundaries** - —É–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

### **–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
7. **E2E Tests** - –¥–æ–±–∞–≤–∏—Ç—å Playwright —Ç–µ—Å—Ç—ã
8. **Performance Monitoring** - –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
9. **Documentation** - —Å–æ–∑–¥–∞—Ç—å migration guides

## üîç **–ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**

### **–†–µ—à–µ–Ω–Ω—ã–µ:**
- ‚úÖ S3 403 errors - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ ACL: 'public-read'
- ‚úÖ TanStack Query cache invalidation - –¥–≤–æ–π–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è
- ‚úÖ Next.js Image S3 domains - –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- ‚úÖ FileDropzone UX - —É–ª—É—á—à–µ–Ω preview –∏ –∫–Ω–æ–ø–∫–∏

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- üîç Performance impact TanStack Query vs SWR
- üîç S3 storage costs –∏ usage patterns
- üîç Bundle size –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π

## üìã **Migration Checklist –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π**

**–ë–∞–∑–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (–±–µ–∑ S3):**
- [ ] –°–æ–∑–¥–∞—Ç—å TanStack Query —Ö—É–∫–∏ –ø–æ –æ–±—Ä–∞–∑—Ü—É map-templates
- [ ] –û–±–Ω–æ–≤–∏—Ç—å UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ –Ω–æ–≤—ã–µ —Ö—É–∫–∏  
- [ ] –û–±–Ω–æ–≤–∏—Ç—å Server Actions —Ç–∏–ø–∏–∑–∞—Ü–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –ø–æ –æ–±—Ä–∞–∑—Ü—É map-templates
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å FSD compliance

**–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (—Å S3):**
- [ ] –î–æ–±–∞–≤–∏—Ç—å ImageSet –ø–æ–ª—è –≤ —Å—Ö–µ–º—É
- [ ] –°–æ–∑–¥–∞—Ç—å image specs –¥–ª—è —Å—É—â–Ω–æ—Å—Ç–∏
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å FileDropzone –≤ —Ñ–æ—Ä–º—ã
- [ ] –û–±–Ω–æ–≤–∏—Ç—å Server Actions –¥–ª—è S3
- [ ] –û–±–Ω–æ–≤–∏—Ç—å UI –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã S3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

---

> **–°—Ç–∞—Ç—É—Å:** Map Templates - —ç—Ç–∞–ª–æ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞ ‚úÖ  
> **–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** Tournament Templates migration  
> **–¶–µ–ª—å:** –í—Å–µ —Å—É—â–Ω–æ—Å—Ç–∏ –Ω–∞ TanStack Query v5 + S3 –∫ –∫–æ–Ω—Ü—É —è–Ω–≤–∞—Ä—è 