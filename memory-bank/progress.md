# Progress Tracker

## Этап 0: Планирование и архитектура

- **[✓]** Проанализирована первоначальная архитектурная документация.
- **[✓]** Выявлены потенциальные проблемы и предложены улучшения.
- **[✓]** Проведена реструктуризация и обновление документации в `architecture/`.
- **[✓]** `Memory Bank` создан и синхронизирован с финальной архитектурой.

## Этап 1: Инициализация и базовые модели

- **[✓]** Создана базовая структура каталогов проекта.
- **[✓]** Инициализировано Next.js приложение и настроены базовые конфигурации.
- **[✓]** Настроен Docker Compose для локальной разработки.
- **[✓]** Настроен `migrate-mongo`.
- **[✓]** Реализована базовая абстракция для кэша (`getCacheAdapter`) с Redis.
- **[✓]** Реализован базовый логгер (Winston).
- **[✓]** Созданы Mongoose модели для всех ключевых сущностей (Tournament, Map, Player, Family и их сателлиты).
- **[✓]** Настроена тестовая среда Jest для работы с ESM-модулями.
- **[✓]** Реализована логика генерации `slug` для турниров и карт в доменных сервисах (`TournamentService`, `MapService`).

## Этап 2: Рефакторинг - Мягкое удаление (`archivedAt`)

- **Цель:** Заменить разрозненные статусы (`active`, `inactive`, `deleted`) на единое поле `archivedAt` для унифицированного механизма мягкого удаления по всему приложению.

- **Выполнено:**
  - **[✓]** **Player:** Модель, репозиторий, сервис и API-маршруты (выполнено ранее).
  - **[✓]** **Family:** Модель, репозиторий, сервис и API-маршруты.
  - **[✓]** **Tournament:** Модель, репозиторий, сервис и API-маршруты.
  - **[✓]** **Тестирование:** Обновлена стратегия тестирования API. Тесты для `route.js` теперь изолированы от БД и мокают слой сервисов для увеличения скорости и точности.

- **Осталось сделать:**
  - **[ ]** **Map:** Провести рефакторинг модели, репозитория, сервиса и API.
  - **[ ]** **TournamentTemplate:** Провести рефакторинг модели, репозитория, сервиса и API.
  - **[ ]** **MapTemplate:** Провести рефакторинг модели, репозитория, сервиса и API.
  - **[ ]** Проверить и отрефакторить все связанные сущности, которые могут ссылаться на архивируемые объекты.

## Этап 3: Реализация бизнес-логики

- **[✓]** Реализован метод для агрегации статистики турнира (`Aggregation Pipeline`) в `TournamentRepository`.
- **[✓]** Созданы API-маршруты (Route Handlers) для управления турнирами (CRUD).
- **[ ]** Создать API-маршруты (Route Handlers) для управления картами.
- **[ ]** Реализовать логику загрузки и парсинга статистики из JSON-файла на странице карты.
- **[ ]** Реализовать процесс завершения карты с обновлением статистики игроков и семей.

## Этап 4: Тестирование

- **[✓]** Написаны интеграционные тесты для CRUD-операций API турниров (`/api/admin/tournaments` и `.../[id]`).
- **[ ]** Написать unit-тесты для Mongoose-схем (`Player`, `Family`, `Tournament`) для проверки валидации, хуков и виртуальных полей.
- **[ ]** Написать unit-тесты для `TournamentService` (проверить генерацию slug).
- **[ ]** Написать unit-тесты для `MapService` (проверить генерацию сложного slug).
- **[ ]** Написать интеграционные тесты для `TournamentRepository.getTournamentStats` (проверить работу Aggregation Pipeline с mock-данными).

## Этап 5: API

- **[✓]** Реализован эндпоинт `POST /api/admin/tournaments` для создания турниров.
- **[✓]** Реализованы эндпоинты `GET`, `PUT`, `DELETE` для `/api/admin/tournaments/[id]`.
- **[ ]** Реализовать эндпоинт `POST /api/admin/maps` для создания карт.
- **[ ]** Реализовать эндпоинт `GET /api/public/tournaments/[slug]/stats` для получения статистики турнира. 