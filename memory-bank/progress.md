# Progress Tracker

## Завершённые задачи (Done)

### Этап 0: Архитектура и настройка
- **[✓]** Проанализирована и обновлена архитектурная документация (`/architecture`).
- **[✓]** Настроена базовая структура проекта: Next.js, Docker, Jest, `migrate-mongo`.
- **[✓]** Реализованы базовые утилиты: `getCacheAdapter` (Redis), `Winston` (логгер).
- **[✓]** Созданы все ключевые Mongoose модели.

### Этап 1: Базовый CRUD и рефакторинг API
- **[✓]** Реализованы CRUD-операции для всех основных сущностей (Tournaments, Maps, Players, Families, Templates).
- **[✓]** Внедрена централизованная система обработки ошибок (`handleApiError` и кастомные ошибки).
- **[✓]** Проведен рефакторинг механизма "мягкого удаления" через поле `archivedAt`.
- **[✓]** Реализована логика автоматической смены статуса `planned`/`active` для карт и турниров.

### Этап 2: Стабилизация и ключевые фичи
- **[✓]** **Генерация Slug**: Реализована новая, надежная система генерации `slug` для турниров и карт.
- **[✓]** **Глобальный рефакторинг тестов**: Все интеграционные тесты переведены на новый стандарт с `test-helpers.js`, моки сервисов убраны.
- **[✓]** **Реализовано "Завершение Карты"**: Полностью разработан и протестирован бизнес-процесс завершения карты, включая:
  - Обновление статуса карты, `winner` и `mvp`.
  - Обновление рейтинга семьи-победителя (`Family.rating` и `FamilyMapParticipation`).
  - Обновление рейтинга игроков (`Player.rating` и `PlayerMapParticipation`).
  - Реализована логика отката (`rollbackMapCompletion`).
- **[✓]** **Стабилизация кодовой базы**: Все 85 интеграционных тестов успешно проходят (`npm test`). Кодовая база стабильна.
- **[✓]** **Обновлена документация**: `10-testing-strategy.md` дополнена новыми анти-паттернами (особенно про Zod).

---

## Предстоящие задачи (Next Steps)

### Этап 3: Укрепление фундамента (Foundation)
- **Статус:** **[ОЖИДАНИЕ]**
- [ ] **Аудит тестов:** Провести финальную ревизию существующих тестов на предмет соответствия стратегии.
- [ ] **Аудит сервисов:** Проверить, что все сервисы используют DI и получают зависимости в конструкторе.

### Этап 4: Функционал
- **Статус:** **[ОЖИДАНИЕ]**
- [ ] **Реализовать создание сущности "Новости" (News)**: Модель, репозиторий, сервис и API-маршруты.
- [ ] **Рефакторинг эндпоинтов архивации `Tournaments`**: Перевести эндпоинт на `PATCH /.../[id]/archive`.
- [ ] **Реализовать начисление призов**: Логика начисления `Earnings` при завершении турнира.

## Этап 2: Рефакторинг - Мягкое удаление (`archivedAt`)

- **Цель:** Заменить разрозненные статусы на единое поле `archivedAt` для унифицированного механизма мягкого удаления.
- **Статус:** **[ЗАВЕРШЕНО]**

- **Выполнено:**
  - **[✓]** **Player:** Модель, репозиторий, сервис и API-маршруты.
  - **[✓]** **Family:** Модель, репозиторий, сервис и API-маршруты.
  - **[✓]** **Tournament:** Модель, репозиторий, сервис и API-маршруты.
  - **[✓]** **Map:** Модель, репозиторий, сервис и API-маршруты.
  - **[✓]** **TournamentTemplate:** Модель, репозиторий, сервис и API-маршруты.
  - **[✓]** **MapTemplate:** Модель, репозиторий, сервис и API-маршруты.
  - **[✓]** Все связанные сущности проверены и обновлены.

## Этап 4: Жизненный цикл Турнира

- **[✓]** Реализовать логику завершения турнира.
- **[✓]** Реализовать начисление призов.

## Этап 5: API

- **[✓]** Реализован эндпоинт `POST /api/admin/tournaments` для создания турниров.
- **[✓]** Реализованы эндпоинты `GET`, `PUT`, `DELETE` для `/api/admin/tournaments/[id]`.
- **[✓]** Реализовать эндпоинт `GET /api/public/tournaments/[slug]/stats` для получения статистики турнира.

## В процессе (In Progress)

### Архитектура и Рефакторинг
- [ ] **Рефакторинг эндпоинтов архивации `Tournaments`**: Перевести эндпоинт на `PATCH /.../[id]/archive`.

### Функционал
- [ ] **Реализовать создание сущности "Новости" (News)**: Модель, репозиторий, сервис и API-маршруты.

## Готово (Done)
*Этот раздел объединен с основными этапами для устранения дублирования.* 